server:
  port: 8080

spring:
  cloud:
    consul:
      discovery:
        prefer-ip-address: true # ğŸŒ å„ªå…ˆä½¿ç”¨ IP è¨»å†Šèˆ‡å¥åº·æª¢æŸ¥
        health-check-path: /actuator/health # â¤ï¸ å¥åº·æª¢æŸ¥ç«¯é»è·¯å¾‘
        ip-address: ${SERVICE_IP:${spring.cloud.client.ip-address}} # ğŸ§­ æœå‹™ IPï¼Œå„ªå…ˆç”¨ç’°å¢ƒè®Šæ•¸è¦†å¯«
        service-name: ${spring.application.name}  # ğŸ·ï¸ æœå‹™åç¨±ï¼ˆè¨»å†Šåˆ° Consulï¼‰
        instance-id: ${spring.application.name}-${server.port}  # ğŸ”¢ å¯¦ä¾‹ IDï¼Œé¿å…åŸ è™Ÿè¡çª

  cache:
    caffeine:
      spec: initialCapacity=100,maximumSize=500,expireAfterWrite=10m # ç·©å­˜åˆå§‹åŒ–å®¹é‡ç‚º 100ï¼Œæœ€å¤§å®¹é‡ç‚º 500ï¼Œå¯«å…¥å¾Œ 10 åˆ†é˜éæœŸ

springdoc:
  swagger-ui:
    path: /swagger-ui.html
    urls:
      - name: GSS.Vital.AuthNService
        url: /authn/v3/authn-docs
      - name: GSS.Vital.AuthPService
        url: /authp/v3/authp-docs
      - name: GSS.Vital.BlacklistService
        url: /blacklist/v3/blacklist-docs
      - name: GSS.Vital.TenantService
        url: /tenant/v3/tenant-docs
      - name: GSS.Vital.BizFormAPIService
        url: /bizform/swagger/v1/swagger.json
      - name: GSS.Vital.MailService
        url: /mail/swagger/v1/swagger.json
      - name: GSS.Vital.TerritoryService
        url: /territory/swagger/v1/swagger.json
      - name: GSS.Vital.ReportingService
        url: /reporting/swagger/v1/swagger.json
      - name: GSS.Vital.PettyCashService
        url: /petty-cash/swagger/v1/swagger.json
      - name: GSS.Vital.GeoSyncService
        url: /geo-sync/swagger/v1/swagger.json

gateway:
  security:
    refresh-token-path: /authn/oauth/refresh-token

auth:
  service:
    base-url: ${AUTH_SERVICE_BASE_URL:lb://authn-service} # å‹•æ…‹é…ç½®æˆæ¬Šæœå‹™ URL

authn:
  internal-base-url: http://authn-service # ğŸ“¡ Gateway å‘¼å« AuthN å¾®æœå‹™çš„å…§éƒ¨ URLï¼ˆä¾› callback token æ›å– access token ä½¿ç”¨ï¼‰

blacklist:
  service:
    # é»‘åå–®æœå‹™çš„åç¨±
    # é€™å€‹åç¨±æ‡‰èˆ‡æœå‹™è¨»å†Šä¸­å¿ƒï¼ˆå¦‚ Eurekaã€Consul æˆ– Kubernetesï¼‰ä¸­å®šç¾©çš„æœå‹™åç¨±ä¸€è‡´
    name: blacklist-service

    # é»‘åå–®æª¢æŸ¥çš„ API è·¯å¾‘
    # è©²è·¯å¾‘æœƒé™„åŠ åˆ°é»‘åå–®æœå‹™çš„åŸºç¤ URLï¼Œä¾‹å¦‚ï¼šhttp://blacklist-service/blacklist/check
    check-path: /blacklist/check

    # è«‹æ±‚é»‘åå–®æœå‹™çš„è¶…æ™‚æ™‚é–“ï¼ˆä»¥ç§’ç‚ºå–®ä½ï¼‰
    # ç•¶è¶…éè©²æ™‚é–“æ²’æœ‰éŸ¿æ‡‰æ™‚ï¼Œè«‹æ±‚å°‡è¢«è¦–ç‚ºå¤±æ•—
    timeout: 5

  # lastUrlByTenantï¼ˆç§Ÿæˆ¶ â†’ ç«¯é»ï¼‰çš„æœ¬åœ°å¿«å–è¨­å®š
  last-url-cache:
    # æœ€å¤§å¿«å–é …ç›®æ•¸ï¼ˆentriesï¼‰ï¼›è¶…éæœƒè‡ªå‹•é€å‡ºï¼Œé¿å… JVM è¨˜æ†¶é«”è†¨è„¹
    # å¿ƒæ³•ï¼šæ´»èºç§Ÿæˆ¶æ•¸ Ã— 2~3 å€ï¼›å¯ä¾ç’°å¢ƒè¦†è“‹ï¼ˆapplication-*.yamlï¼‰
    max-size: 60000

app:
  bizform:
    query-path: /bizform/api/Documents/Query # BizForm æŸ¥è©¢ API è·¯å¾‘
  security:
    redirect-validation-paths:
      - "/authn/oauth/authorize" # æª¢æŸ¥ OAuth æˆæ¬Šã€Œç™¼èµ·ç«¯é»ã€ï¼›è·¯å¾‘å°šæœª StripPrefixï¼ˆåŸå§‹ /authn/...ï¼‰
      - "/oauth/authorize"       # æª¢æŸ¥ OAuth æˆæ¬Šã€Œç™¼èµ·ç«¯é»ã€ï¼›StripPrefix=1 ä¹‹å¾Œå¯¦éš›é€²å…¥éæ¿¾å™¨çš„è·¯å¾‘
    allowed-redirect-uris:
      - "http://localhost:8080/authn/oauth/callback"           # DEV - æœ¬åœ°é–‹ç™¼æ™‚ OAuth æˆæ¬Šå›èª¿ç«¯é»ï¼ˆå¾Œç«¯è™•ç†æˆæ¬Šç¢¼ï¼‰
      - "https://cb-svc-api.vitalcb.com/authn/oauth/callback"  # SIT - SITç’°å¢ƒå¾Œç«¯è™•ç† OAuth æˆæ¬Šç¢¼çš„å›èª¿ç«¯é»
      - "https://cb-svc-api.vitalext.com/authn/oauth/callback" # UAT - UATç’°å¢ƒå¾Œç«¯è™•ç† OAuth æˆæ¬Šç¢¼çš„å›èª¿ç«¯é»

    # ------------------------------------------------------------
    # permit-all : é€²å…¥ Gateway æ™‚ã€Œå… Spring-Security èªè­‰ã€ï¼Œ
    #              ä½†ä¾ç„¶æœƒé€šé InternalTokenFilter é©—è­‰ JWT èˆ‡åŸºæœ¬æˆæ¬Šã€‚
    #              âœ æœªæ”œå¸¶æœ‰æ•ˆ JWT å‰‡è¿”å› 401ã€‚
    #              âœ é©ç”¨æ–¼ç™»å…¥å¾Œå¯ç›´æ¥å­˜å–ï¼Œä½†ä¸éœ€å†é€²å…¥ Spring Security çš„è·¯å¾‘ã€‚
    # ------------------------------------------------------------
    permit-all:
      # # ğŸ‘‰ ä½¿ç”¨è€…ä»¥ã€Œç³»çµ±ä½¿ç”¨è€… JWTã€äº¤æ›å–å¾— BizForm å°ˆç”¨ JWTï¼ˆuser-delegationï¼‰
      - /authn/oauth/token/exchange

      # ğŸ‘‰ ä½ˆå»ºéšæ®µï¼šå…è¨±åŒ¿åå‘¼å«ä»¥æ›å–ã€Œç„¡ depotIdã€çš„ BizForm Token
      #    åƒ…èƒ½ç”¨æ–¼å»ºç«‹ç«™å°ï¼Œä¸èƒ½è¨ªå•ä»»ä½• BizForm è³‡æ–™ã€‚
      #    âš ï¸ å¯¦éš›å®‰å…¨ä»éœ€é…åˆ X-Bootstrap-Secret header é©—è­‰ã€‚
      - /authn/oauth/token/exchange-bootstrap

      # ğŸ‘‰ æœå‹™å°æœå‹™ï¼ˆM2Mï¼‰ç”¨ã€Œæ©Ÿå™¨æ†‘è­‰ã€æ›å– å…§éƒ¨æœå‹™å­˜å– Token
      - /authn/oauth2/token

      # ğŸ‘‰ è™•ç†ä½¿ç”¨è€…ç™»å‡ºï¼Œæ¸…é™¤é»‘åå–®ã€Cookie èˆ‡å¿«å–è³‡è¨Š
      - /authn/oauth/logout

      # ğŸ‘‰ æä¾› iframe å°ˆç”¨çš„ callback tokenï¼Œä¾›å¤–éƒ¨ç•«é¢å›æ‰“ç³»çµ± API ä½¿ç”¨ âš ï¸ é ˆé©—è­‰ç³»çµ± JWTï¼Œç¢ºèªæ¬Šé™èˆ‡ç§Ÿæˆ¶åˆæ³•æ€§
      - /authn/callback-token

      # ğŸ‘‰ ç®¡ç†æ¬Šé™èˆ‡ç§Ÿæˆ¶è¨­å®šï¼ˆå»ºç«‹ã€æ›´æ–°ã€åˆªé™¤ç­‰ï¼‰
      - /authp/**

      # ğŸ‘‰ ç®¡ç† JWT é»‘åå–®èˆ‡å¿«å–åŒæ­¥
      - /blacklist/**

      # ğŸ‘‰ ç®¡ç†ç§Ÿæˆ¶è³‡è¨Šã€è¨‚å–®èˆ‡è³‡æ–™åº«é€£ç·šè¨­å®š
      - /tenant/**

      # ğŸ‘‰ æå ±èˆ‡åŒæ­¥ BizForm è¡¨å–®è³‡æ–™ï¼Œéœ€é©—ç³»çµ± JWT èˆ‡æ¬Šé™
      - /bizform/**

      # ğŸ‘‰ ç®¡ç†èˆ‡æŸ¥è©¢å®¶ç³»åœ–æˆå“¡é—œä¿‚
      - /genogram/**

      # ğŸ‘‰ ç™¼é€ç³»çµ±é€šçŸ¥èˆ‡éƒµä»¶
      - /mail/**

      # ğŸ‘‰ ç®¡ç†èˆ‡æŸ¥è©¢è²¬ä»»å€åŠè¡Œæ”¿å€è³‡æ–™
      - /territory/**

      # ğŸ‘‰ ç”¢è£½èˆ‡æŸ¥è©¢å ±è¡¨è³‡æ–™
      - /reporting/**

      # ğŸ‘‰ ç®¡ç†èˆ‡æ ¸éŠ·é›¶ç”¨é‡‘è³‡æ–™
      - /petty-cash/**

      # ğŸ‘‰ åŒæ­¥æŒ‡å®šåœ‹å®¶çš„è¡Œæ”¿å€è³‡æ–™è‡³ç§Ÿæˆ¶è³‡æ–™åº«ï¼ˆtenant onboarding å°ˆç”¨ï¼‰
      - /geo-sync/**

cors:
  allowed-origins:
    - "http://localhost:7001"                    # DEV - å‰ç«¯æœ¬åœ°é–‹ç™¼ç’°å¢ƒï¼ˆé€šå¸¸ä½¿ç”¨ Vite/React æœ¬åœ°å•Ÿå‹•ï¼‰
    - "https://cb-svc-web.vitalcb.com"           # SIT - VitalCaseBridge å‰ç«¯æ¸¬è©¦ç’°å¢ƒï¼ˆSIT æ¸¬è©¦ä½¿ç”¨ï¼‰
    - "https://cb-svc-web.vitalext.com"          # UAT - VitalCaseBridge å‰ç«¯æ¸¬è©¦ç’°å¢ƒï¼ˆUAT æ¸¬è©¦ä½¿ç”¨ï¼‰
    - "https://member.vikosmos.com"              # DEV - BizForm æ¸¬è©¦ç’°å¢ƒï¼ˆç”¨æ–¼è¡¨å–®æœå‹™ç°½æ ¸æ¸¬è©¦ï¼‰
    - "https://bizform.vitalyun.com"             # UAT - BizForm æ­£å¼ç’°å¢ƒï¼ˆå¯¦éš›å°å¤–ç°½æ ¸æœå‹™ï¼‰
    - "https://cloud-member.gss.com.tw"          # DEV - å¸³è™Ÿä¸­å¿ƒæ¸¬è©¦ç’°å¢ƒï¼ˆOAuth ç™»å…¥èˆ‡æˆæ¬Šæ¸¬è©¦ï¼‰
    - "https://member.gsscloud.com"              # UAT - å¸³è™Ÿä¸­å¿ƒæ­£å¼ç’°å¢ƒï¼ˆå¯¦éš›ç™»å…¥èˆ‡æˆæ¬Šä¾†æºï¼‰
    - "https://demo.genogram.cloud"              # DEV - å®¶ç³»åœ–åµŒå…¥ iframe é é¢ä¾†æºï¼ˆiframe è¼‰å…¥å…è¨±è·¨åŸŸï¼‰
  allowed-methods:
    - "GET"       # æŸ¥è©¢è³‡æº
    - "POST"      # å»ºç«‹è³‡æº
    - "PUT"       # æ›´æ–°æ•´å€‹è³‡æº
    - "DELETE"    # åˆªé™¤è³‡æº
    - "OPTIONS"   # é æª¢è«‹æ±‚ï¼ˆç€è¦½å™¨è‡ªå‹•ç™¼å‡ºï¼Œç”¨æ–¼ CORS é©—è­‰ï¼‰
    - "PATCH"     # æ›´æ–°éƒ¨åˆ†æ¬„ä½ï¼ˆéƒ¨åˆ†ä¿®æ”¹è³‡æºï¼ŒRESTful å¸¸è¦‹ï¼‰

  allowed-headers:
    - "Authorization"              # JWT æˆ– OAuth Token é©—è­‰ç”¨
    - "Content-Type"               # è«‹æ±‚æ ¼å¼è²æ˜ï¼Œä¾‹å¦‚ application/json
    - "Refresh-Token"              # Refresh Tokenï¼Œç”¨æ–¼æ›ç™¼ access token
    - "X-Current-Page"             # åˆ†é ï¼šç›®å‰é æ•¸ï¼ˆå‰ç«¯è‡ªå®šç¾© headerï¼‰
    - "X-Page-Size"                # åˆ†é ï¼šæ¯é è³‡æ–™é‡
    - "X-Total-Count"              # åˆ†é ï¼šç¸½ç­†æ•¸ï¼ˆå¤šç”¨æ–¼ response headerï¼Œä½†ä¿ç•™å…è¨±è«‹æ±‚ç«¯å¸¶å…¥ï¼‰
    - "X-Requested-With"           # Ajax è«‹æ±‚è­˜åˆ¥ï¼ˆä¾‹å¦‚ XMLHttpRequestï¼ŒæŸäº› UI æ¡†æ¶æœƒè‡ªå¸¶ï¼‰
    - "Accept"                     # æ¥å—çš„å›æ‡‰æ ¼å¼ï¼Œä¾‹å¦‚ application/jsonã€text/html ç­‰
    - "X-Instance-ExpirationDate"  # å‰ç«¯è‡ªè¨‚ï¼šå¯¦ä¾‹åˆ°æœŸæ—¥ã€‚å¿…é ˆåˆ—å…¥ allowed-headersï¼Œå¦å‰‡é æª¢ï¼ˆOPTIONSï¼‰
                                   # çš„ Access-Control-Request-Headers æœƒè¢« CORS æ“‹ä¸‹ï¼ŒPOST æ‰“ä¸åˆ°å¾Œç«¯ã€‚
                                   # è¨»ï¼šç¨‹å¼æœƒè½‰å°å¯«æ¯”å°ï¼Œå¤§å°å¯«ä¸å½±éŸ¿ã€‚