server:
  address: 0.0.0.0
  port: 8080 # å¾®æœå‹™ç«¯å£ï¼Œç”¨æ–¼æœ¬åœ°é–‹ç™¼å’Œæ¸¬è©¦

spring:
  cloud:
    consul:
      discovery:
        prefer-ip-address: true
        service-name: ${spring.application.name}
        instance-id: ${spring.application.name}-${server.port}

  cache:
    caffeine:
      spec: initialCapacity=100,maximumSize=500,expireAfterWrite=10m # ç·©å­˜åˆå§‹åŒ–å®¹é‡ç‚º 100ï¼Œæœ€å¤§å®¹é‡ç‚º 500ï¼Œå¯«å…¥å¾Œ 10 åˆ†é˜éæœŸ

springdoc:
  swagger-ui:
    path: /swagger-ui.html
    urls:
      - name: GSS.Vital.AuthNService
        url: /authn/v3/authn-docs
      - name: GSS.Vital.AuthPService
        url: /authp/v3/authp-docs
#      - name: authz
#        url: /authz/v3/api-docs
      - name: GSS.Vital.BlacklistService
        url: /blacklist/v3/blacklist-docs
#      - name: todo
#        url: /todo/v3/api-docs
      - name: GSS.Vital.BizFormAPIService
        url: /bizform/swagger/v1/swagger.json
      - name: GSS.Vital.MailService
        url: /mail/swagger/v1/swagger.json

auth:
  service:
    base-url: ${AUTH_SERVICE_BASE_URL:lb://authn-service} # å‹•æ…‹é…ç½®æˆæ¬Šæœå‹™ URL

authn:
  internal-base-url: http://authn-service # ğŸ“¡ Gateway å‘¼å« AuthN å¾®æœå‹™çš„å…§éƒ¨ URLï¼ˆä¾› callback token æ›å– access token ä½¿ç”¨ï¼‰

blacklist:
  service:
    # é»‘åå–®æœå‹™çš„åç¨±
    # é€™å€‹åç¨±æ‡‰èˆ‡æœå‹™è¨»å†Šä¸­å¿ƒï¼ˆå¦‚ Eurekaã€Consul æˆ– Kubernetesï¼‰ä¸­å®šç¾©çš„æœå‹™åç¨±ä¸€è‡´
    name: blacklist-service

    # é»‘åå–®æª¢æŸ¥çš„ API è·¯å¾‘
    # è©²è·¯å¾‘æœƒé™„åŠ åˆ°é»‘åå–®æœå‹™çš„åŸºç¤ URLï¼Œä¾‹å¦‚ï¼šhttp://blacklist-service/blacklist/check
    check-path: /blacklist/check

    # è«‹æ±‚é»‘åå–®æœå‹™çš„è¶…æ™‚æ™‚é–“ï¼ˆä»¥ç§’ç‚ºå–®ä½ï¼‰
    # ç•¶è¶…éè©²æ™‚é–“æ²’æœ‰éŸ¿æ‡‰æ™‚ï¼Œè«‹æ±‚å°‡è¢«è¦–ç‚ºå¤±æ•—
    timeout: 5

app:
  bizform:
    query-path: /bizform/api/Documents/Query # BizForm æŸ¥è©¢ API è·¯å¾‘
  security:
    redirect-validation-paths:
      - "/authn/oauth" # OAuth é©—è­‰çš„è·³è½‰è·¯å¾‘
    allowed-redirect-uris:
      - "http://localhost:8080/authn/oauth/callback"           # DEV - æœ¬åœ°é–‹ç™¼æ™‚ OAuth æˆæ¬Šå›èª¿ç«¯é»ï¼ˆå¾Œç«¯è™•ç†æˆæ¬Šç¢¼ï¼‰
      - "https://cb-svc-api.vitalext.com/authn/oauth/callback" # STAGING / PROD - ä¸Šç·šç’°å¢ƒå¾Œç«¯è™•ç† OAuth æˆæ¬Šç¢¼çš„å›èª¿ç«¯é»

    # ------------------------------------------------------------
    # permit-all : é€²å…¥ Gateway æ™‚ã€Œå… Spring-Security èªè­‰ã€ï¼Œ
    #              ä½†ä¾ç„¶æœƒé€šé InternalTokenFilter é©—è­‰ JWT èˆ‡åŸºæœ¬æˆæ¬Šã€‚
    #              âœ æœªæ”œå¸¶æœ‰æ•ˆ JWT å‰‡è¿”å› 401ã€‚
    #              âœ é©ç”¨æ–¼ç™»å…¥å¾Œå¯ç›´æ¥å­˜å–ï¼Œä½†ä¸éœ€å†é€²å…¥ Spring Security çš„è·¯å¾‘ã€‚
    # ------------------------------------------------------------
    permit-all:
      # ğŸ‘‰ æä¾›ä½¿ç”¨è€…ä»¥ç³»çµ± JWT æ›å– BizForm å°ˆç”¨ JWT
      - /authn/oauth/token/exchange

      # ğŸ‘‰ è™•ç†ä½¿ç”¨è€…ç™»å‡ºï¼Œæ¸…é™¤é»‘åå–®ã€Cookie èˆ‡å¿«å–è³‡è¨Š
      - /authn/oauth/logout

      # ğŸ‘‰ æä¾› iframe å°ˆç”¨çš„ callback tokenï¼Œä¾›å¤–éƒ¨ç•«é¢å›æ‰“ç³»çµ± API ä½¿ç”¨
      #     âš ï¸ é ˆé©—è­‰ç³»çµ± JWTï¼Œç¢ºèªæ¬Šé™èˆ‡ç§Ÿæˆ¶åˆæ³•æ€§
      - /authn/callback-token

      # ğŸ‘‰ å¾®æœå‹™é–“é€šè¨Šä½¿ç”¨çš„ Internal Token ç°½ç™¼ API
      #     âš ï¸ åƒ…å…è¨±å—ä¿¡ä»»çš„å…§éƒ¨æœå‹™å‘¼å«ï¼ˆé€šå¸¸ä»¥ JWT æˆ– API Key é©—è­‰ï¼‰
      - /authn/internal-token

      # ğŸ‘‰ æ¬Šé™æˆæ¬Šæœå‹™ï¼ŒåŒ…å«è§’è‰²ã€è³‡æºæ¬Šé™é©—è­‰ç­‰æŸ¥è©¢æ“ä½œ
      - /authz/**

      # ğŸ‘‰ æ¬Šé™èˆ‡ç§Ÿæˆ¶è¨­å®šæœå‹™ï¼ˆå»ºç«‹ã€æ›´æ–°ã€åˆªé™¤ç­‰ï¼‰
      - /authp/**

      # ğŸ‘‰ JWT é»‘åå–®ç®¡ç†ï¼Œæ”¯æ´é»‘åå–®æŸ¥è©¢èˆ‡å¿«å–åŒæ­¥
      - /blacklist/**

      # ğŸ‘‰ Todo ç®¡ç† APIï¼ˆç¯„ä¾‹æœå‹™ï¼‰
      - /todo/**

      # ğŸ‘‰ BizForm æå ±ã€åŒæ­¥ç­‰å°ˆç”¨ APIï¼Œéœ€é©—ç³»çµ± JWT èˆ‡è§’è‰²ã€åœ°å€æ¬Šé™
      - /bizform/**

      # ğŸ‘‰ å®¶ç³»åœ–æœå‹™ï¼ŒåŒ…å«æˆå“¡é—œä¿‚ç®¡ç†èˆ‡æŸ¥è©¢
      - /genogram/**

      # ğŸ‘‰ mailæœå‹™ï¼Œç™¼ä¿¡åŠŸèƒ½
      - /mail/**

cors:
  allowed-origins:
    - "http://localhost:7001"                    # DEV - å‰ç«¯æœ¬åœ°é–‹ç™¼ç’°å¢ƒï¼ˆé€šå¸¸ä½¿ç”¨ Vite/React æœ¬åœ°å•Ÿå‹•ï¼‰
    - "https://cb-svc-web.vitalcb.com"           # SIT - VitalCaseBridge å‰ç«¯æ¸¬è©¦ç’°å¢ƒï¼ˆSIT æ¸¬è©¦ä½¿ç”¨ï¼‰
    - "https://cb-svc-web.vitalext.com"          # UAT - VitalCaseBridge å‰ç«¯æ¸¬è©¦ç’°å¢ƒï¼ˆUAT æ¸¬è©¦ä½¿ç”¨ï¼‰
    - "https://member.vikosmos.com"              # DEV - BizForm æ¸¬è©¦ç’°å¢ƒï¼ˆç”¨æ–¼è¡¨å–®æœå‹™ç°½æ ¸æ¸¬è©¦ï¼‰
    - "https://bizform.vitalyun.com"             # UAT - BizForm æ­£å¼ç’°å¢ƒï¼ˆå¯¦éš›å°å¤–ç°½æ ¸æœå‹™ï¼‰
    - "https://cloud-member.gss.com.tw"          # DEV - å¸³è™Ÿä¸­å¿ƒæ¸¬è©¦ç’°å¢ƒï¼ˆOAuth ç™»å…¥èˆ‡æˆæ¬Šæ¸¬è©¦ï¼‰
    - "https://member.gsscloud.com"              # UAT - å¸³è™Ÿä¸­å¿ƒæ­£å¼ç’°å¢ƒï¼ˆå¯¦éš›ç™»å…¥èˆ‡æˆæ¬Šä¾†æºï¼‰
    - "https://demo.genogram.cloud"              # DEV - å®¶ç³»åœ–åµŒå…¥ iframe é é¢ä¾†æºï¼ˆiframe è¼‰å…¥å…è¨±è·¨åŸŸï¼‰
  allowed-methods:
    - "GET"       # æŸ¥è©¢è³‡æº
    - "POST"      # å»ºç«‹è³‡æº
    - "PUT"       # æ›´æ–°æ•´å€‹è³‡æº
    - "DELETE"    # åˆªé™¤è³‡æº
    - "OPTIONS"   # é æª¢è«‹æ±‚ï¼ˆç€è¦½å™¨è‡ªå‹•ç™¼å‡ºï¼Œç”¨æ–¼ CORS é©—è­‰ï¼‰
    - "PATCH"     # æ›´æ–°éƒ¨åˆ†æ¬„ä½ï¼ˆéƒ¨åˆ†ä¿®æ”¹è³‡æºï¼ŒRESTful å¸¸è¦‹ï¼‰

  allowed-headers:
    - "Authorization"       # JWT æˆ– OAuth Token é©—è­‰ç”¨
    - "Content-Type"        # è«‹æ±‚æ ¼å¼è²æ˜ï¼Œä¾‹å¦‚ application/json
    - "Refresh-Token"       # Refresh Tokenï¼Œç”¨æ–¼æ›ç™¼ access token
    - "X-Current-Page"      # åˆ†é ï¼šç›®å‰é æ•¸ï¼ˆå‰ç«¯è‡ªå®šç¾© headerï¼‰
    - "X-Page-Size"         # åˆ†é ï¼šæ¯é è³‡æ–™é‡
    - "X-Total-Count"       # åˆ†é ï¼šç¸½ç­†æ•¸ï¼ˆå¤šç”¨æ–¼ response headerï¼Œä½†ä¿ç•™å…è¨±è«‹æ±‚ç«¯å¸¶å…¥ï¼‰
    - "X-Requested-With"    # Ajax è«‹æ±‚è­˜åˆ¥ï¼ˆä¾‹å¦‚ XMLHttpRequestï¼ŒæŸäº› UI æ¡†æ¶æœƒè‡ªå¸¶ï¼‰
    - "Accept"              # æ¥å—çš„å›æ‡‰æ ¼å¼ï¼Œä¾‹å¦‚ application/jsonã€text/html ç­‰