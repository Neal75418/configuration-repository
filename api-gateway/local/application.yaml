spring:
  web:
    resources:
      # ğŸš« é—œé–‰é è¨­ /staticã€/public ç­‰éœæ…‹è·¯å¾‘
      add-mappings: false

    cors:
      # ğŸª„ æŠŠ CorsWebFilter / CorsConfiguration çš„è¨­å®š
      #     è‡ªå‹•æ³¨å…¥åˆ° Spring Security 4xx/5xx å›æ‡‰
      add-to-spring-security: true

  cloud:
    consul:
      discovery:
        health-check-path: /actuator/health
        ip-address: ${SERVICE_IP:127.0.0.1} # IP åœ°å€ï¼Œå„ªå…ˆä½¿ç”¨å¤–éƒ¨å‚³å…¥çš„ç’°å¢ƒè®Šæ•¸

    gateway:
      server:
        webflux:
          default-filters:
            - StripPrefix=1 # ç§»é™¤è·¯å¾‘ä¸­çš„ç¬¬ä¸€å±¤å‰ç¶´
          routes:
            # æˆæ¬Šä¼ºæœå™¨è·¯ç”±
            - id: authn-service
              uri: lb://authn-service # é€šéè² è¼‰å‡è¡¡å™¨æŒ‡å‘ `authn-service`
              predicates:
                - Path=/authn/** # åŒ¹é…ä»¥ /authn/ é–‹é ­çš„è«‹æ±‚è·¯å¾‘
              filters:
                - RedirectUriValidationFilter # è‡ªå®šç¾©éæ¿¾å™¨ï¼Œç”¨æ–¼æª¢æŸ¥ `redirect_uri` æ˜¯å¦åˆæ³•

            # æˆæ¬Šæª¢æŸ¥æœå‹™è·¯ç”±
            - id: authz-service
              uri: lb://authz-service # è² è¼‰å‡è¡¡åˆ° `authz-service`
              predicates:
                - Path=/authz/** # åŒ¹é… /authz/ é–‹é ­çš„è«‹æ±‚

            # æ¬Šé™è™•ç†æœå‹™è·¯ç”±
            - id: authp-service
              uri: lb://authp-service # è² è¼‰å‡è¡¡åˆ° `authp-service`
              predicates:
                - Path=/authp/** # åŒ¹é… /authp/ é–‹é ­çš„è«‹æ±‚

            # é»‘åå–®æœå‹™è·¯ç”±
            - id: blacklist-service
              uri: lb://blacklist-service # è² è¼‰å‡è¡¡åˆ° `blacklist-service`
              predicates:
                - Path=/blacklist/** # åŒ¹é… /blacklist/ é–‹é ­çš„è«‹æ±‚

            # å¾…è¾¦äº‹é …æœå‹™è·¯ç”±
            - id: todo-service
              uri: lb://todo-service
              predicates:
                - Path=/todo/**

            # BizForm æœå‹™è·¯ç”±
            - id: VitalBizFormService
              uri: lb://VitalBizFormService # è² è¼‰å‡è¡¡åˆ° `bizform-service`
              predicates:
                - Path=/bizform/** # åŒ¹é… /bizform/ é–‹é ­çš„è«‹æ±‚
              filters:
                - CacheRequestBody=String

            # Genogram æœå‹™è·¯ç”± å®¶ç³»åœ–
            - id: GenogramService
              uri: lb://GenogramService # è² è¼‰å‡è¡¡åˆ° `genogram-service`
              predicates:
                - Path=/genogram/** # åŒ¹é… /genogram/ é–‹é ­çš„è«‹æ±‚

            # mail æœå‹™è·¯ç”±
            - id: MailService
              uri: lb://MailService # è² è¼‰å‡è¡¡åˆ° `mail-service`
              predicates:
                - Path=/mail/** # åŒ¹é… /mail/ é–‹é ­çš„è«‹æ±‚

  data:
    redis:
      host: ${REDIS_HOST:localhost} # Redis ä¸»æ©Ÿåœ°å€ï¼Œæ”¯æŒå¤–éƒ¨ç’°å¢ƒè®Šæ•¸é…ç½®
      port: ${REDIS_PORT:6379}      # Redis é»˜èªç«¯å£
      password: ${REDIS_PASSWORD:GssAuthRedis111}  # Redis å¯†ç¢¼ï¼Œç•™ç©ºè¡¨ç¤ºç„¡å¯†ç¢¼
      timeout: 5s  # è¨­å®šé€£ç·šè¶…æ™‚ç‚º 5 ç§’
      lettuce:
        pool:
          max-active: 50      # æœ€å¤§é€£æ¥æ•¸
          max-idle: 15        # æœ€å¤§ç©ºé–’é€£æ¥æ•¸
          min-idle: 5         # æœ€å°ç©ºé–’é€£æ¥æ•¸
          max-wait: 2000ms    # æœ€å¤§ç­‰å¾…æ™‚é–“

jwt:
  issuer: ${JWT_ISSUER_URI:http://localhost:8080/authn} # JWT ç°½ç™¼è€…çš„ URI
  jwk-set-uri: ${JWT_JWK_SET_URI:http://localhost:8080/authn/jwks/publicKey} # JWK å…¬é‘°çš„ URI
  signature-algorithm: ES256 # ä½¿ç”¨ ECï¼ˆæ©¢åœ“æ›²ç·šï¼‰ç°½åç®—æ³•
  time-skew:
    seconds: 60 # æ™‚é–“åç§»ï¼Œå…è¨± JWT é©—è­‰æ™‚å®¹å¿çš„æ™‚å·®
  valid:
    audiences: ${JWT_VALID_AUDIENCES:http://localhost:8080} # JWT çš„å—çœ¾é©—è­‰

test:
  depot-id: cspsd_test