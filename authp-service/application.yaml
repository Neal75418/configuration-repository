server:
  port: 8082

spring:
  cloud:
    consul:
      discovery:
        prefer-ip-address: true # 🌐 優先使用 IP 註冊與健康檢查
        health-check-path: /actuator/health # ❤️ 健康檢查端點路徑
        ip-address: ${SERVICE_IP:${spring.cloud.client.ip-address}} # 🧭 服務 IP，優先用環境變數覆寫
        service-name: ${spring.application.name}  # 🏷️ 服務名稱（註冊到 Consul）
        instance-id: ${spring.application.name}-${server.port}  # 🔢 實例 ID，避免埠號衝突

  cache:
    caffeine:
      spec: initialCapacity=100,maximumSize=500,expireAfterWrite=10m # Cache 初始容量、最大容量與過期時間配置

  # 供 MultiTenant provider 取連線用（Boot 不直接管理 DataSource）
  datasource:
    host: ${MYSQL_HOST:}
    port: ${MYSQL_PORT:}
    username: ${MYSQL_USERNAME:}
    password: ${MYSQL_PASSWORD:}

  jpa: # JPA 和 Hibernate 配置
    properties:
      hibernate:
        show_sql: false # 顯示 SQL 語句（開發環境開啟）
        format_sql: false # 格式化 SQL 語句（開發環境開啟）
    hibernate:
      ddl-auto: none # 生產環境建議使用 none
    open-in-view: false # 禁用 Open Session In View，以提升性能

authn:
  token:
    url: ${AUTHN_TOKEN_URL:http://api-gateway/authn/oauth2/token}  # 發 token 端

  client:
    id: ${AUTHN_CLIENT_ID:authp-service}                    # 在 AuthN 註冊的 client_id
    secret: ${AUTHP_CLIENT_SECRET:dummy}                    # 用環境變數或 Secret 注入
    auth-method: ${AUTHN_CLIENT_AUTH_METHOD:secret}         # secret | private_key_jwt（你用 secret）
    client-auth: ${AUTHN_CLIENT_AUTH_IN:header}             # header(Basic) | body(form)
  audience: ${AUTHN_AUDIENCE:tenant-service}                # 這顆 token 要打的下游服務（ex: tenant-service）
  scope: ${AUTHN_SCOPE:tenant.read tenant.bizform.read}     # 最小必要權限

authp:
  http:
    timeout:
      connect-ms: 5000   # 連線建立逾時（毫秒）
      read-ms: 5000      # 讀取回應逾時（毫秒）

external:
  http:
    timeout:
      connect-ms: 10000  # 對外部服務連線逾時
      read-ms: 30000     # 對外部服務讀取逾時

# MultiTenant provider 透過 Gateway 取得 DBInfo
gateway:
  machine-token:
    target: tenant-read  # 申請 M2M token 的 target_service（避免簽發端 fallback）
  base-url: http://api-gateway:8080  # Gateway 基底位址

tenant:
  dbinfo-path: /tenant/api/tenants/%s  # DBInfo 路徑，使用 tenantId 格式化
  internal-base-url: http://tenant-service
  api-prefix: /directory

internal:
  token:
    expected-audience: authp-service           # TenantFilter 用於判斷「內部 token」

app:
  mt:
    jdbc:
      sslMode: REQUIRED                 # 在 local dev 檔覆寫為 DISABLED
      extra: ""
  security:
    public-paths:
      # ---------- 🔍 健康 / 監控 ----------
      - "/actuator/health"        # 健康檢查 (readiness / liveness)
      - "/actuator/prometheus"    # Prometheus 指標

      # ---------- 👤 用戶前置查詢 ----------
#      - "/users/*/default-tenant"              # 取預設租戶（登入前呼叫）
#      - "/users/*/details"                     # 取用戶詳情（建立 JWT 時用）
#      - "/permissions/internal/permissions/*"  # 查詢使用者權限（建立快取用，登入流程會呼叫

      # ---------- 📄 Swagger / OpenAPI ----------
      - "/swagger-ui.html"        # Swagger UI
      - "/swagger-ui/**"          # Swagger 靜態資源
      - "/v3/authp-docs"          # AuthP 自訂 docs 入口

invite-user-setting:
  case-bridge-url: https://cb-svc-web.vitalcb.com
  vital-login-url: https://member.vikosmos.com/cas/login?service=https://www.vikosmos.com/tw/&locale=zh