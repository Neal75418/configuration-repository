server:
  address: 0.0.0.0
  port: 8082

spring:
  cloud:
    consul:
      discovery:
        prefer-ip-address: true
        service-name: ${spring.application.name}
        instance-id: ${spring.application.name}-${server.port}

  cache:
    caffeine:
      spec: initialCapacity=100,maximumSize=500,expireAfterWrite=10m # Cache åˆå§‹å®¹é‡ã€æœ€å¤§å®¹é‡èˆ‡éæœŸæ™‚é–“é…ç½®

  # =========================
  # è³‡æ–™ä¾†æºï¼ˆä¾› MultiTenant provider ä½¿ç”¨ï¼›Spring Boot ä¸ç›´æ¥ç®¡ç†ï¼‰
  # =========================
  datasource:
    host: ${MYSQL_HOST:localhost}
    port: ${MYSQL_PORT:3306}
    username: ${MYSQL_USERNAME:root}
    password: ${MYSQL_PASSWORD:}

  # =========================
  # JPA / Hibernate
  # =========================
  jpa:
    properties:
      hibernate.show_sql: false       # ç·šä¸Šé—œé–‰ SQL log
      hibernate.format_sql: true
    hibernate.ddl-auto: validate      # åƒ…é©— schemaï¼›å»ºè­°ç”± Flyway/Liquibase ç®¡ç†
    open-in-view: false               # é—œé–‰ OIV é¿å…æ‡¶è¼‰å…¥è¸©é›·

authn:
  token:
    url: ${AUTHN_TOKEN_URL:http://api-gateway/authn/oauth2/token}  # ç™¼ token ç«¯
  client:
    id: authp-service                                 # åœ¨ AuthN è¨»å†Šçš„ client_id
    auth-method: secret                               # å¯æ”¹ private_key_jwtï¼›è¦‹ä¸‹æ–¹è¨»è§£å€
    secret: ${AUTHP_CLIENT_SECRET}                    # ä¸çµ¦é è¨­ï¼›ç”±ç’°å¢ƒè®Šæ•¸/Secret æ³¨å…¥
    client-auth: ${AUTHN_CLIENT_AUTH_IN:header}       # header=Basic | body=form
  audience: tenant-service                            # é€™é¡† token è¦æ‰“çš„ä¸‹æ¸¸æœå‹™ï¼ˆex: tenant-serviceï¼‰
  scope: tenant.read tenant.write                     # æœ€å°å¿…è¦æ¬Šé™

# ==== Gateway / å…§éƒ¨å‘¼å«ï¼ˆçµ¦ MultiTenantConnectionProvider å– DBInfo ç”¨ï¼‰ ====
gateway:
  base-url: http://api-gateway
tenant:
  dbinfo-path: /tenant/api/tenants/%s  # ä»¥ tenantId æ ¼å¼åŒ–çµ„è·¯å¾‘

# ï¼ˆå¼·çƒˆå»ºè­°ï¼‰å‚™æ´ internal tokenï¼ˆåªåœ¨ M2M å¤±æ•—æ™‚ç”¨ï¼‰
internal:
  token:
    value: ${INTERNAL_TOKEN:}                  # æœ‰å°±å¡«ï¼›æ²’æœ‰ä¹Ÿå¯ä¸å¡«
    expected-audience: authp-service           # ä½ é€šç”¨ yml çš„é è¨­

app:
  mt:
    jdbc:
      sslMode: REQUIRED                 # dev å¯è¦†è“‹ç‚º DISABLED
      extra: ""                         # dev å¯è¦†è“‹ allowPublicKeyRetrieval=true
  security:
    public-paths:
      # ---------- ğŸ” å¥åº· / ç›£æ§ ----------
      - "/actuator/health"        # å¥åº·æª¢æŸ¥ (readiness / liveness)
      - "/actuator/prometheus"    # Prometheus æŒ‡æ¨™

      # ---------- ğŸ‘¤ ç”¨æˆ¶å‰ç½®æŸ¥è©¢ ----------
      - "/users/*/default-tenant"              # å–é è¨­ç§Ÿæˆ¶ï¼ˆç™»å…¥å‰å‘¼å«ï¼‰
      - "/users/*/details"                     # å–ç”¨æˆ¶è©³æƒ…ï¼ˆå»ºç«‹ JWT æ™‚ç”¨ï¼‰
      - "/permissions/internal/permissions/*"  # æŸ¥è©¢ä½¿ç”¨è€…æ¬Šé™ï¼ˆå»ºç«‹å¿«å–ç”¨ï¼Œç™»å…¥æµç¨‹æœƒå‘¼å«

      # ---------- ğŸ“„ Swagger / OpenAPI ----------
      - "/swagger-ui.html"        # Swagger UI
      - "/swagger-ui/**"          # Swagger éœæ…‹è³‡æº
      - "/v3/authp-docs"          # AuthP è‡ªè¨‚ docs å…¥å£