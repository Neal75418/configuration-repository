spring:
  cloud:
    consul: # Consul æœå‹™è¨»å†Šèˆ‡ç™¼ç¾é…ç½®
      discovery:
        healthCheckUrl: http://authn-service:${server.port}/actuator/health
        ip-address: ${SERVICE_IP:${spring.cloud.client.ip-address}} # å‹•æ…‹ IP åœ°å€
  security: # OAuth2 å®¢æˆ¶ç«¯é…ç½®
    oauth2:
      client:
        registration: # è¨»å†Šå®¢æˆ¶ç«¯ä¿¡æ¯
          oauth:
            provider: gss # è‡ªå®šç¾© OAuth2 æä¾›è€…åç¨±
            client-id: ${OAUTH_CLIENT_ID:} # å®¢æˆ¶ç«¯ IDï¼Œé€šéç’°å¢ƒè®Šæ•¸é…ç½®
            client-secret: ${OAUTH_CLIENT_SECRET:} # å®¢æˆ¶ç«¯å¯†é‘°ï¼Œé€šéç’°å¢ƒè®Šæ•¸é…ç½®
            authorization-grant-type: authorization_code # æˆæ¬Šé¡å‹
            redirect-uri: ${BASE_URL:https://cb-svc-api.vitalext.com}}/authn/oauth/callback # é‡å®šå‘ URIï¼ˆé–‹ç™¼ç’°å¢ƒï¼‰
        provider: # OAuth2 æä¾›è€…ç›¸é—œ URL
          gss:
            authorization-uri: https://member.gsscloud.com/cas/oauth2.0/authorize # æˆæ¬Š URL
            token-uri: https://member.gsscloud.com/cas/oauth2.0/token # ä»¤ç‰Œç™¼æ”¾ URL
            user-info-uri: https://member.gsscloud.com/cas/oauth2.0/profile # ç”¨æˆ¶ä¿¡æ¯ URL

  data:
    redis: # Redis é…ç½®
      host: ${REDIS_HOST:auth_redis} # Redis ä¸»æ©Ÿåœ°å€
      port: ${REDIS_PORT:6379} # Redis åŸ è™Ÿ
      password: ${REDIS_PASSWORD:} # Redis å¯†ç¢¼ï¼ˆå¦‚æœæœ‰å‰‡å¡«å¯«ï¼‰
      timeout: 5s  # è¨­å®šé€£ç·šè¶…æ™‚ç‚º 5 ç§’
      lettuce:
        pool:
          max-active: 50      # æœ€å¤§é€£æ¥æ•¸
          max-idle: 15        # æœ€å¤§ç©ºé–’é€£æ¥æ•¸
          min-idle: 5         # æœ€å°ç©ºé–’é€£æ¥æ•¸
          max-wait: 2000ms    # é€£æ¥ç­‰å¾…æ™‚é–“

auth: # è‡ªå®šç¾©èªè­‰ç›¸é—œé…ç½®
  registration-id: oauth # OAuth2 è¨»å†Š ID
  redirect:
    final-uri: ${FINAL_URI:http://localhost:7001} # èªè­‰æˆåŠŸå¾Œé‡å®šå‘çš„ URI
  issuer: ${AUTH_ISSUER:http://localhost:8080/authn} # JWT ç°½ç™¼è€…çš„ URI
  aud: ${AUTH_AUDIENCES:http://localhost:8080} # JWT çš„å—çœ¾é©—è­‰
  token:
    max-retries: ${TOKEN_REFRESH_MAX_RETRIES:3} # æœ€å¤§é‡è©¦æ¬¡æ•¸ï¼ˆå»ºè­°å€¼ï¼š1-5ï¼‰
    buffer-time-seconds: 3600 # ç·©è¡æ™‚é–“ï¼ˆç§’ï¼‰ï¼Œæ­¤è™•ç‚º1å°æ™‚
    cache-duration-days: 7 # ç·©å­˜æœ‰æ•ˆæœŸé…ç½®ï¼ˆé»˜èªç‚º 7 å¤©ï¼‰
    access-token-expiration-ms: ${ACCESS_TOKEN_EXPIRATION:900000}   # Access Token çš„éæœŸæ™‚é–“ï¼ˆ15 åˆ†é˜ï¼Œæ”¯æŒè¦†è“‹ï¼‰
    refresh-token-expiration-ms: ${TOKEN_REFRESH_EXPIRATION:2592000000} # Refresh Token çš„éæœŸæ™‚é–“ï¼ˆ30 å¤©ï¼Œæ”¯æŒè¦†è“‹ï¼‰

jwt:
  key:
    id: ec-key-1       # é‡‘é‘°çš„å”¯ä¸€æ¨™è­˜ç¬¦ (Key ID, kid)ï¼Œé€šå¸¸ç”¨æ–¼å€åˆ†å¤šå€‹é‡‘é‘°
    curve: P-256       # æ©¢åœ“æ›²ç·š (Elliptic Curve, EC) çš„é¡å‹ï¼Œé€™è£¡ä½¿ç”¨çš„æ˜¯ P-256 æ›²ç·šï¼ˆä¹Ÿç¨±ç‚º secp256r1ï¼‰ï¼Œ
    # å®ƒæ˜¯ä¸€ç¨®å¸¸ç”¨çš„æ©¢åœ“æ›²ç·šï¼Œæä¾›è‰¯å¥½çš„æ€§èƒ½å’Œå®‰å…¨æ€§ï¼Œé©åˆç”Ÿæˆå’Œé©—è­‰ JWT ç°½å

key:
  directory: ${KEY_DIRECTORY:keys/} # é‡‘é‘°å­˜æ”¾ç›®éŒ„
  private-file: ${KEY_PRIVATE_FILE:ec_private.key} # ç§é‘°æ–‡ä»¶å
  public-file: ${KEY_PUBLIC_FILE:ec_public.key} # å…¬é‘°æ–‡ä»¶å

# =========================
# AuthPï¼ˆæˆæ¬Š/æ¬Šé™å¾®æœå‹™ï¼‰â€” prod
# =========================
authp:
  internal-base-url: http://authp-service   # æœå‹™è¨»å†Šåæˆ–å…§éƒ¨ DNSï¼ˆ@LoadBalanced è§£æï¼‰
  user-uri-prefix: /users                   # ä½¿ç”¨è€… API å‰ç¶´ï¼ˆè‹¥ç‰ˆæœ¬åŒ–å¯è¦†å¯«å¦‚ /v1/usersï¼‰
  internal-token: ""                        # âŒ æ­£å¼ç’°å¢ƒç¦ç”¨å›ºå®š token

# =========================
# AuthNï¼ˆæœ¬æœå‹™ï¼‰M2M è¨­å®š â€” prod
# ç”¨æ–¼å‘å…§éƒ¨å¾®æœå‹™ï¼ˆå« AuthP / tenant / reportingï¼‰ç´¢å–/é™„æ›æ©Ÿå™¨æ†‘è­‰
# =========================
authn:
  # ğŸ‘‡ ç”¨å“ªç¨®å®¢æˆ¶ç«¯æ†‘è­‰æ©Ÿåˆ¶æ‹¿ M2M token
  client:
    auth-method: ${M2M_AUTH_METHOD:secret}  # secret | private_key_jwt
    id: ${M2M_CLIENT_ID}                    # å¿…å¡«ï¼šç™¼ token ç«¯è¨»å†Šçš„ client_id
    secret: ${M2M_CLIENT_SECRET:}           # ç•¶ auth-method=secret æ™‚å¿…å¡«
    private-jwk: ${M2M_PRIVATE_JWK:}        # ç•¶ auth-method=private_key_jwt æ™‚æä¾›ï¼ˆJWK JSONï¼‰
    public-jwk: ${M2M_PUBLIC_JWK:}          # å¯é¸ï¼šä¾¿æ–¼å°ç«¯è¨»å†Š/æ ¡é©—ï¼ˆè‹¥ç”¨ JWK Set å¯å¿½ç•¥ï¼‰

  # ğŸ‘‡ å»æ‹¿ token çš„ç«¯é» & æ¬Šé™ç¯„åœ
  token:
    url: ${AUTHN_TOKEN_URL:http://api-gateway:8080/authn/oauth/token}  # ç™¼ token ç«¯
  audience: ${M2M_AUDIENCE:authp-service}   # âœ… èˆ‡å°ç«¯ TenantFilter çš„ expectedAudience å°ä¸Š
  scope: ${M2M_SCOPE:system:tenant:override}# âœ… ä»¥ scope æ§åˆ¶æ”¾è¡Œèˆ‡æœ€å°æ¬Šé™

  # ğŸ‘‡ ç°½ç™¼ä¸‹æ¸¸ Access Token çš„ç›®æ¨™å—çœ¾ï¼ˆè¦æ‰“èª°å°±è¨­èª°ï¼‰
  access-token:
    audience: tenant-service                 # ä¾‹ï¼štenant-service / reporting-serviceï¼ˆç”¨ profile è¦†å¯«ï¼‰

  # ğŸ‘‡ HTTP é€¾æ™‚ï¼ˆä¾ä½ åŸºç¤è¨­æ–½èª¿æ•´ï¼‰
  http:
    timeout:
      connect-ms: 4000                       # é€£ç·šé€¾æ™‚ï¼ˆæ¯«ç§’ï¼‰
      read-ms: 6000                          # è®€å–é€¾æ™‚ï¼ˆæ¯«ç§’ï¼‰

bizform: # BizForm å¤–éƒ¨ç³»çµ± API é…ç½®
  api:
    base-url: ${BIZFORM_API_BASE_URL:https://bizform.vitalyun.com} # BizForm API åŸºç¤ URL
    login-endpoint: /Backend/api/account/login # ç™»éŒ„ç«¯é»
    exchange-endpoint: /Backend/api/account/token # äº¤æ›æŒ‡å®šç«™å°çš„token

crm: # CRM å¤–éƒ¨ç³»çµ± API é…ç½®
  api:
    uri: http://crm-api.dev.local/Internal/auth

app:
  cookie:
    domain: vitalext.com

# æŒ‡å®šä½¿ç”¨ log4j2-logstash.xml ä½œç‚º logging è¨­å®šæª”ï¼Œå•Ÿç”¨ Logstash è¼¸å‡º
logging:
  config: classpath:log4j2-logstash.xml

test:
  depot-id: cspsd_test

springdoc:
  swagger-ui:
    enabled: false       # é—œé–‰ Swagger UI é é¢ï¼ˆ/swagger-ui.htmlï¼‰ï¼Œé¿å…åœ¨ç”Ÿç”¢ç’°å¢ƒæš´éœ² API æ–‡ä»¶
  api-docs:
    enabled: false       # é—œé–‰ OpenAPI JSON æ–‡ä»¶ï¼ˆ/v3/api-docsï¼‰ï¼Œé˜²æ­¢ API schema å¤–æ´©
