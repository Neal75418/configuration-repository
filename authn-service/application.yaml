server:
  address: 0.0.0.0
  port: 8081

spring:
  cloud:
    consul:
      discovery:
        prefer-ip-address: true
        service-name: ${spring.application.name}
        instance-id: ${spring.application.name}-${server.port}

  cache:
    caffeine:
      spec: initialCapacity=100,maximumSize=500,expireAfterWrite=10m # Cache åˆå§‹å®¹é‡ã€æœ€å¤§å®¹é‡èˆ‡éæœŸæ™‚é–“é…ç½®

static:
  resources:
    cache:
      period: 3600

authn:
  token:
    url: ${AUTHN_TOKEN_URL:http://api-gateway/authn/oauth2/token}  # M2M token ç™¼è¡Œç«¯é»ï¼ˆå¯ç¶“ Gatewayï¼‰

  m2m:
    targets:
      tenant-read:
        audience: tenant-service
        scope: tenant.read
      tenant-write:
        audience: tenant-service
        scope: tenant.read tenant.write
      authp-read:
        audience: authp-service
        scope: authp.read

    target: tenant-read
    scope-override:

  client:
    id: ${AUTHN_CLIENT_ID:authn-service}
    auth-method: ${AUTHN_CLIENT_AUTH_METHOD:secret}   # secret | private_key_jwt
    client-auth: ${AUTHN_CLIENT_AUTH_IN:header}       # header=Basic | body=form
    secret: ${AUTHN_CLIENT_SECRET:}                   # dev/staging æ‰æœƒçµ¦

  clients: # InMemory RegisteredClient ç”¨ï¼ˆç”± OAuthClientConfig è®€ï¼‰
    authn-service:
      secret-hash: ${AUTHN_SECRET_HASH}
    authp-service:
      secret-hash: ${AUTHP_SECRET_HASH}
    reporting-service:
      secret-hash: ${REPORTING_SECRET_HASH}

  # HTTP é€£ç·šåƒæ•¸ï¼ˆM2M ç™¼ Token æˆ–å…§éƒ¨å‘¼å«çš„é€¾æ™‚ï¼‰
  http:
    timeout:
      connect-ms: 5000                            # é€£ç·šé€¾æ™‚ï¼ˆæ¯«ç§’ï¼‰
      read-ms: 5000                               # è®€å–é€¾æ™‚ï¼ˆæ¯«ç§’ï¼‰

# optionalï¼šå¤–éƒ¨ RT timeout
external:
  http:
    timeout:
      connect-ms: 10000
      read-ms: 30000

authp:
  internal-base-url: http://authp-service   # æœå‹™è¨»å†Šåæˆ–å…§éƒ¨ DNSï¼ˆå»ºè­° @LoadBalanced è§£æï¼‰
  user-uri-prefix: /users                   # ä½¿ç”¨è€… API å‰ç¶´ï¼ˆå¦‚ /users/{id}/rolesï¼‰

app:
  security:
    public-paths:
      # ---------- ğŸŒ éœæ…‹è³‡æº ----------
      - "/public/**"            # å‰ç«¯éœæ…‹æª” (JS / CSS / img)
      - "/static/**"            # å‚³çµ± static ç›®éŒ„
      - "/favicon.ico"          # ç¶²ç«™ icon

      # ---------- ğŸ” å¥åº· / ç›£æ§ ----------
      - "/actuator/health"      # å¥åº·æª¢æŸ¥
      - "/actuator/prometheus"  # Prometheus æŒ‡æ¨™

      # ---------- ğŸ”‘ OIDC / JWT ç›¸é—œ ----------
      - "/authn/.well-known/**" # OIDC Discovery (AuthN è·¯å¾‘)
      - "/authn/jwks/publicKey" # JWK public key (AuthN è·¯å¾‘)
      - "/.well-known/**"       # OIDC Discovery root fallback
      - "/jwks/publicKey"       # JWK root fallback
      - "/authn/oauth/login"    # OAuth2 login
      - "/authn/oauth/callback" # OAuth2 callback
      - "/oauth/login"          # é€šç”¨ login fallback
      - "/oauth/callback"       # é€šç”¨ callback fallback
      - "/oauth2/authorization/**" # Spring Security OIDC ç«¯é»

      # ---------- ğŸ“„ Swagger / OpenAPI ----------
      - "/swagger-ui.html"      # Swagger UI
      - "/swagger-ui/**"        # Swagger éœæ…‹è³‡æº
      - "/v3/authn-docs"        # AuthN è‡ªè¨‚ docs å…¥å£

    # AuthN ç”¨ï¼šSecurityConfig ä¸­æ”¾è¡Œçš„ API
    permit-all:
      - "/authn/oauth2/token"        # çµ¦ç¶“é Gateway çš„å‘¼å«
      - "/oauth2/token"              # çµ¦ç›´æ‰“ AuthN çš„å‘¼å«ï¼ˆStripPrefix ä¹‹å¾Œï¼‰
      - "/oauth/token/exchange"     # ç³»çµ± JWT æ› BizForm å°ˆç”¨ JWT
      - "/oauth/token/exchange-callback"  # çµ¦ API Gateway æ› token ç”¨
      - "/oauth/logout"             # ä½¿ç”¨è€…ç™»å‡º
      - "/oauth/refresh-token"      # åˆ·æ–° access token
      - "/oauth/me"                 # å–å¾—ä½¿ç”¨è€…è³‡è¨Š
      - "/callback-token"           # ç°½ç™¼ iframe callback token
      - "/internal-token"           # ç°½ç™¼å¾®æœå‹™ internal token