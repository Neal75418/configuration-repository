server:
  port: 8081

spring:
  cloud:
    consul:
      discovery:
        prefer-ip-address: true # ğŸŒ å„ªå…ˆä½¿ç”¨ IP è¨»å†Šèˆ‡å¥åº·æª¢æŸ¥
        health-check-path: /actuator/health # â¤ï¸ å¥åº·æª¢æŸ¥ç«¯é»è·¯å¾‘
        ip-address: ${SERVICE_IP:${spring.cloud.client.ip-address}} # ğŸ§­ æœå‹™ IPï¼Œå„ªå…ˆç”¨ç’°å¢ƒè®Šæ•¸è¦†å¯«
        service-name: ${spring.application.name}  # ğŸ·ï¸ æœå‹™åç¨±ï¼ˆè¨»å†Šåˆ° Consulï¼‰
        instance-id: ${spring.application.name}-${server.port}  # ğŸ”¢ å¯¦ä¾‹ IDï¼Œé¿å…åŸ è™Ÿè¡çª

  cache:
    caffeine:
      spec: initialCapacity=100,maximumSize=500,expireAfterWrite=10m # Cache åˆå§‹å®¹é‡ã€æœ€å¤§å®¹é‡èˆ‡éæœŸæ™‚é–“é…ç½®

authn:
  token:
    # M2M token ç™¼è¡Œç«¯é»ï¼ˆç¶“ Gatewayï¼ŒğŸ¤–ï¼‰
    url: ${AUTHN_TOKEN_URL:http://api-gateway/authn/oauth2/token}

  # M2M ç›®æ¨™ï¼ˆTenant/ AuthPï¼‰ï¼ˆğŸ¤–ï¼‰
  m2m:
    targets:
      tenant-read:
        audience: tenant-service
        scope: tenant.read tenant.bizform.read
        targetService: tenant-service
      tenant-write:
        audience: tenant-service
        scope: tenant.read tenant.write
        targetService: tenant-service
      authp-read:
        audience: authp-service
        scope: authp.read
        targetService: authp-service

  client: # M2M å®¢æˆ¶ç«¯èªè­‰æ–¹å¼ï¼ˆğŸ¤–ï¼‰
    id: ${AUTHN_CLIENT_ID:authn-service}
    auth-method: ${AUTHN_CLIENT_AUTH_METHOD:secret}   # secret | private_key_jwtï¼ˆğŸ¤–ï¼‰
    client-auth: ${AUTHN_CLIENT_AUTH_IN:header}       # header=Basic | body=formï¼ˆğŸ¤–ï¼‰
    secret: ${AUTHN_CLIENT_SECRET:}                   # é prod å¯çµ¦ï¼ˆğŸ¤–ï¼‰

  # InMemory RegisteredClientï¼ˆç”± OAuthClientConfig è®€ï¼‰ï¼ˆğŸ¤– å„æ©Ÿå™¨å®¢æˆ¶ç«¯ï¼‰
  clients:
    authn-service:
      secret-hash: ${AUTHN_SECRET_HASH}
    authp-service:
      secret-hash: ${AUTHP_SECRET_HASH}
    reporting-service:
      secret-hash: ${REPORTING_SECRET_HASH}

  # å…§éƒ¨ HTTP é€¾æ™‚ï¼ˆğŸ¤– å¸¸ç”¨æ–¼å…§éƒ¨äº¤æ›ï¼‰
  http:
    timeout:
      connect-ms: 5000                            # é€£ç·šé€¾æ™‚ï¼ˆæ¯«ç§’ï¼‰
      read-ms: 5000                               # è®€å–é€¾æ™‚ï¼ˆæ¯«ç§’ï¼‰

# optionalï¼šå¤–éƒ¨ RT timeoutï¼ˆå¤–éƒ¨ç³»çµ±ï¼ŒğŸ‘¤/ğŸ¤– ä¾å‘¼å«å ´æ™¯ï¼‰
external:
  http:
    timeout:
      connect-ms: 10000
      read-ms: 30000

# å…§éƒ¨æœå‹™ä½å€ï¼ˆğŸ‘¤/ğŸ¤– éƒ½å¯èƒ½å‘¼å«ï¼‰
authp:
  internal-base-url: http://authp-service

tenant:
  internal-base-url: http://tenant-service    # ğŸŒ å…§éƒ¨ Tenant æœå‹™åŸºåº• URL
  api-prefix: /directory                      # ğŸ›£ï¸ API å‰ç¶´è·¯å¾‘
  api-paths:                                  # ğŸ”— å„åŠŸèƒ½ç«¯é»è¨­å®š
    users-tenants: /users/{userId}/tenants    # ğŸ‘¥ æŸ¥ä½¿ç”¨è€…å¯åˆ‡æ›çš„ç§Ÿæˆ¶æ¸…å–®
    tenant-by-id: /tenants/{tenantId}         # ğŸ·ï¸ ä¾ç§Ÿæˆ¶ ID æŸ¥ç§Ÿæˆ¶è©³æƒ…
    tenant-user: /tenants/{tenantId}/users/{userId}   # ğŸ” æª¢æŸ¥ä½¿ç”¨è€…æ˜¯å¦å±¬æ–¼ç§Ÿæˆ¶
    tenant-bizform: /tenants/{tenantId}/bizform       # ğŸ§© æŸ¥ç§Ÿæˆ¶çš„ BizForm depotid

app:
  security:
    public-paths:
      # ---------- ğŸŒ éœæ…‹è³‡æº ----------
      - "/public/**"            # å‰ç«¯éœæ…‹æª” (JS / CSS / img)
      - "/static/**"            # å‚³çµ± static ç›®éŒ„
      - "/favicon.ico"          # ç¶²ç«™ icon

      # ---------- ğŸ” å¥åº· / ç›£æ§ ----------
      - "/actuator/health"      # å¥åº·æª¢æŸ¥
      - "/actuator/prometheus"  # Prometheus æŒ‡æ¨™

      # ---------- ğŸ”‘ OIDC / JWT ç›¸é—œï¼ˆğŸ‘¤ ä½¿ç”¨è€…ç™»å…¥ & å…¬é‘°/ç™¼ç¾æ–‡ä»¶ï¼‰ ----------
      - "/authn/.well-known/**" # OIDC Discovery (AuthN è·¯å¾‘)
      - "/authn/jwks/publicKey" # JWK public key (AuthN è·¯å¾‘)
      - "/.well-known/**"       # OIDC Discovery root fallback
      - "/jwks/publicKey"       # JWK root fallback
      - "/authn/oauth/login"    # OAuth2 login
      - "/authn/oauth/callback" # OAuth2 callback
      - "/oauth/login"          # é€šç”¨ login fallback
      - "/oauth/callback"       # é€šç”¨ callback fallback
      - "/oauth2/authorization/**" # Spring Security OIDC ç«¯é»

      # ---------- ğŸ“„ Swagger / OpenAPI ----------
      - "/swagger-ui.html"      # Swagger UI
      - "/swagger-ui/**"        # Swagger éœæ…‹è³‡æº
      - "/v3/authn-docs"        # AuthN è‡ªè¨‚ docs å…¥å£

    # AuthN ç”¨ï¼šSecurityConfig ä¸­æ”¾è¡Œçš„ API
    permit-all:
      - "/authn/oauth2/token"        # çµ¦ç¶“é Gateway çš„å‘¼å«
      - "/oauth2/token"              # çµ¦ç›´æ‰“ AuthN çš„å‘¼å«ï¼ˆStripPrefix ä¹‹å¾Œï¼‰
      - "/oauth/token/exchange"     # ç³»çµ± JWT æ› BizForm å°ˆç”¨ JWT
      - "/oauth/token/exchange-callback"  # çµ¦ API Gateway æ› token ç”¨
      - "/oauth/logout"             # ğŸ‘¤ ç™»å‡º
      - "/oauth/refresh-token"      # ğŸ‘¤ ä»¥ refresh æ› access
      - "/oauth/me"                 # ğŸ‘¤ æŸ¥è©¢è‡ªå·±
      - "/callback-token"           # ğŸ‘¤ iframe/å›èª¿å ´æ™¯
      - "/internal-token"           # ğŸ¤– å¾®æœå‹™ internal tokenï¼ˆåƒ…æ¸¬è©¦/å…§éƒ¨ï¼‰